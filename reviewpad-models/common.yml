api-version: reviewpad.com/v3.x

mode: silent
edition: professional

labels:
  small:
    description: "small pull request"
    color: "#294b69"
  medium:
    description: "medium pull request"
    color: "#a8c3f7"
  large:
    description: "large pull request"
    color: "#8a2138"

rules:
  - name: work-in-progress
    kind: patch
    spec: '$isDraft()'

  - name: does-not-have-linked-issues
    kind: patch
    spec: '!$hasLinkedIssues() && !$rule("work-in-progress")'

workflows:
  - name: add-label-with-size
    always-run: true
    if:
      - rule: $size() <= 30
        extra-actions:
          - '$addLabel("small")'
      - rule: $size() > 30 && $size() <= 100
        extra-actions:
          - '$addLabel("medium")'
      - rule: $size() > 100
        extra-actions:
          - '$addLabel("large")'

  - name: lint-commits
    always-run: true
    if:
      - rule: '!$hasLinearHistory()'
        extra-actions:
          - '$error("This pull request does not have linear history - please fix this!")'
          - '$fail("Commit lint failed")'
      - rule: 'true'
        extra-actions:
          - '$commitLint()'
          - '$titleLint()'

  - name: check-for-linked-issued
    always-run: true
    if:
      - rule: does-not-have-linked-issues
    then:
      - '$info("This pull request does not have a linked issue")'

  - name: setup-reviewer-assignment
    always-run: true
    if:
      - rule: work-in-progress
    then:
        - '$disableActions(["assignRandomReviewer", "assignReviewer", "assignTeamReviewer"])'

  - name: empty-description
    on:
      - "issue"
      - "pull_request"
    always-run: true
    if:
      - $description() == ""
    then: 
      - '$error("The description is empty. Please add more information!")'

  - name: first-time-issue-contributor
    on:
      - "issue"
    always-run: true
    if:
      - rule: $issueCountBy($author(), "all") == 1
        extra-actions:
          - '$commentOnce($sprintf("Welcome @%v! Thank you so much for your first issue!", [$author()]))'

  - name: first-time-pr-contributor
    on:
      - "pull_request"
    always-run: true
    if:
      - rule: $pullRequestCountBy($author(), "all") == 1
        extra-actions:
          - '$commentOnce($sprintf("Welcome @%v! Thank you so much for your first pull request!", [$author()]))'

