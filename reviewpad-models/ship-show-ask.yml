api-version: reviewpad.com/v3.x

labels:
  ship:
    description: "Pull request can be automatically merged and does not require code review"
    color: "#76dbbe"
  show:
    description: "Pull request can be auto-merged and a code review should be done post-merge"
    color: "#2986cc"
  ask:
    description: "Pull request requires a code review before merge"
    color: "#c90076"

rules:
  - name: is-ship
    spec: $contains($description(), "**Ship**:") && !$contains($description(), "<!-- **Ship**:")
  - name: is-show
    spec: $contains($description(), "**Show**:") && !$contains($description(), "<!-- **Show**:")
  - name: is-ask
    spec: $contains($description(), "**Ask**:") && !$contains($description(), "<!-- **Ask**:")

workflows:
  # Label a pull request based on type of merge strategy.
  - name: add-merge-strategy-label
    always-run: true
    if:
      - rule: is-ship
        extra-actions:
          - $addLabel("ship")
      - rule: is-show
        extra-actions:
          - $addLabel("show")
      - rule: is-ask
        extra-actions:
          - $addLabel("ask")

  # Remove type of change labels based on the type of change.
  # This is useful for when the type of change is udpated.
  - name: remove-change-type-label
    always-run: true
    if:
      - rule: '!$rule("is-ship")'
        extra-actions:
          - $removeLabel("ship")
      - rule: '!$rule("is-show")'
        extra-actions:
          - $removeLabel("show")
      - rule: '!$rule("is-ask")'
        extra-actions:
          - $removeLabel("ask")
